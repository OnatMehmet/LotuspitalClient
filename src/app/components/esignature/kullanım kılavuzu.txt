ğŸš€ WebSocket E-Ä°mza Entegrasyonu - Kurulum KÄ±lavuzu
ğŸ“¦ HazÄ±rlanan Dosyalar

WebSocket E-Ä°mza Servisi - Artifact 1
CardLogin Component - Artifact 2
PdfSign Component - Artifact 3


ğŸ”§ Kurulum AdÄ±mlarÄ±
1ï¸âƒ£ WebSocket Servisini OluÅŸturun
Dosya: src/app/services/websocket-eimza.service.ts
Artifact 1'deki kodu kopyalayÄ±n ve bu dosyayÄ± oluÅŸturun.
Bu servis ÅŸunlarÄ± saÄŸlar:

âœ… Terminal (kart okuyucu) listesi
âœ… Login (PIN ile giriÅŸ)
âœ… Sertifika listesi
âœ… Sertifika seÃ§imi
âœ… PDF imzalama


2ï¸âƒ£ CardLogin Component'i GÃ¼ncelleyin
Dosya: src/app/components/cardlogin/cardlogin.component.ts
Artifact 2'deki kodu kopyalayÄ±n.
DEÄÄ°ÅÄ°KLÄ°KLER:
typescript// âŒ ESKÄ° Ä°MPORT - KALDIR
// import { IESignatureService } from '../../services/iesignatureservice';

// âœ… YENÄ° Ä°MPORT - EKLE
import { WebSocketEimzaService, Certificate } from '../services/websocket-eimza.service';
import { Subscription } from 'rxjs';
typescript// âŒ ESKÄ° CONSTRUCTOR - DEÄÄ°ÅTÄ°R
// constructor(private signService: IESignatureService, ...)

// âœ… YENÄ° CONSTRUCTOR - KULLAN
constructor(
    private wsEimzaService: WebSocketEimzaService,
    private modalStateService: IModalStateService
)
HTML dosyasÄ± (cardlogin.component.html) AYNI KALIYOR! DeÄŸiÅŸtirmeyin.

3ï¸âƒ£ PdfSign Component'i GÃ¼ncelleyin
Dosya: src/app/components/pdfsign/pdfsign.component.ts
Artifact 3'teki kodu kopyalayÄ±n.
DEÄÄ°ÅÄ°KLÄ°KLER:
typescript// âŒ ESKÄ° Ä°MPORT - KALDIR
// import { IESignatureService } from '../../services/iesignatureservice';

// âœ… YENÄ° Ä°MPORT - EKLE
import { WebSocketEimzaService } from '../services/websocket-eimza.service';
import { IModalDialogService } from '../../services/imodaldialogservice';
import { CardLoginComponent } from '../cardlogin/cardlogin.component';
typescript// âŒ ESKÄ° CONSTRUCTOR - DEÄÄ°ÅTÄ°R
// constructor(private esignatureService: IESignatureService, ...)

// âœ… YENÄ° CONSTRUCTOR - KULLAN
constructor(
    private fileUploadService: IFileUploadService,
    private wsEimzaService: WebSocketEimzaService,
    private modalStateService: IModalStateService,
    private modalDialogService: IModalDialogService
)
HTML dosyasÄ± (pdfsign.component.html) AYNI KALIYOR! DeÄŸiÅŸtirmeyin.

4ï¸âƒ£ Module'e Ekleyin
Dosya: app.module.ts
typescriptimport { WebSocketEimzaService } from './services/websocket-eimza.service';

@NgModule({
  declarations: [
    CardLoginComponent,
    PdfSignComponent
  ],
  providers: [
    WebSocketEimzaService  // âœ… YENÄ° SERVÄ°S EKLE
  ]
})
export class AppModule { }

5ï¸âƒ£ CertList Component'i KALDIRIN (Opsiyonel)
CertList artÄ±k kullanÄ±lmÄ±yor Ã§Ã¼nkÃ¼ sertifika listesi CardLogin iÃ§inde gÃ¶steriliyor.
EÄŸer baÅŸka yerde kullanÄ±lmÄ±yorsa:

certlist.component.ts silebilirsiniz
certlist.component.html silebilirsiniz
Module'den declaration'Ä± kaldÄ±rabilirsiniz


âœ… Test Edin
1. JNLP UygulamasÄ±nÄ± BaÅŸlatÄ±n
Port 5000'de Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun:
bash# Windows'ta port kontrolÃ¼
netstat -ano | findstr :5000
2. Angular UygulamanÄ±zÄ± BaÅŸlatÄ±n
bashng serve
3. Browser Console'u AÃ§Ä±n
F12 tuÅŸuna basÄ±n ve Console sekmesine geÃ§in.
4. PDF Ä°mzalama SayfasÄ±nÄ± AÃ§Ä±n
PDF imzalama modal'Ä±nÄ± aÃ§Ä±n.
5. "Pdf Ä°mzala" Butonuna TÄ±klayÄ±n
Beklenen AkÄ±ÅŸ:
[PdfSign] onSignPdf() Ã§aÄŸrÄ±ldÄ±
[PdfSign] CardLogin modal aÃ§Ä±lÄ±yor...
    â†“
[CardLogin] Component oluÅŸturuldu
[CardLogin] ngOnInit
[CardLogin] Terminal listesi yÃ¼kleniyor...
[WS Service] getTerminals()
[WS Service] ğŸ“‹ Terminal: 2
[CardLogin] Ä°lk terminal seÃ§ildi: ...
    â†“
KULLANICI: Terminal seÃ§ + PIN gir + "AkÄ±llÄ± Kart GiriÅŸ" tÄ±kla
    â†“
[CardLogin] doLogin() Ã§aÄŸrÄ±ldÄ±
[WS Service] sendCardLibrary(): akisp11.dll
[WS Service] login(): ...
[WS Service] getCertificates()
[WS Service] ğŸ“œ Sertifika: 2
[CardLogin] âœ… Login baÅŸarÄ±lÄ±
[CardLogin] âœ… Sertifikalar alÄ±ndÄ±: 2
    â†“
KULLANICI: Sertifika seÃ§ + "Sertifika SeÃ§" tÄ±kla
    â†“
[CardLogin] selectCertificate() Ã§aÄŸrÄ±ldÄ±
[WS Service] selectCertificate(): ...
[CardLogin] âœ… Sertifika baÅŸarÄ±yla seÃ§ildi
[CardLogin] Modal kapatÄ±lÄ±yor
    â†“
[PdfSign] âœ… Sertifika seÃ§ildi
[PdfSign] PDF imzalama baÅŸlatÄ±lÄ±yor...
[WS Service] signPdf()
[WS Service] PDF Base64 dÃ¶nÃ¼ÅŸÃ¼mÃ¼ tamamlandÄ±
[WS Service] âœ… PDF imzalandÄ±
[PdfSign] âœ… PDF baÅŸarÄ±yla imzalandÄ±
[PdfSign] Ä°mzalÄ± PDF sunucuya yÃ¼kleniyor...
[PdfSign] âœ… Ä°mzalÄ± PDF sunucuya yÃ¼klendi
[PdfSign] Modal kapatÄ±lÄ±yor
    â†“
âœ… BAÅARILI!

ğŸ¯ KullanÄ±cÄ± AkÄ±ÅŸÄ±

"Pdf Ä°mzala" butonuna tÄ±kla
CardLogin Modal aÃ§Ä±lÄ±r:

Terminal listesi otomatik yÃ¼klenir
KullanÄ±cÄ± terminal (kart okuyucu) seÃ§er
PIN girer
"AkÄ±llÄ± Kart GiriÅŸ" butonuna tÄ±klar
SaÄŸ tarafta sertifika listesi belirir
Sertifika seÃ§er
"Sertifika SeÃ§" butonuna tÄ±klar


Modal kapanÄ±r
PDF otomatik imzalanÄ±r
Ä°mzalÄ± PDF sunucuya yÃ¼klenir
Ä°ÅŸlem tamamlanÄ±r âœ…


ğŸ› Sorun Giderme
WebSocket BaÄŸlanamÄ±yor
Hata: "E-Ä°mza uygulamasÄ±na baÄŸlanÄ±lamadÄ±"
Ã‡Ã¶zÃ¼m:

JNLP uygulamasÄ±nÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun
Port 5000'in aÃ§Ä±k olduÄŸunu kontrol edin
Browser console'da WebSocket hatalarÄ±nÄ± kontrol edin

bashnetstat -ano | findstr :5000
Terminal Listesi Gelmiyor
Hata: "Kart okuyucu bulunamadÄ±"
Ã‡Ã¶zÃ¼m:

Kart okuyucunuzun takÄ±lÄ± olduÄŸundan emin olun
JNLP uygulamasÄ±nÄ± yeniden baÅŸlatÄ±n
Browser console'da hata loglarÄ±nÄ± kontrol edin

Sertifika Listesi Gelmiyor
Hata: "KartÄ±nÄ±zda sertifika bulunamadÄ±"
Ã‡Ã¶zÃ¼m:

PIN'in doÄŸru girildiÄŸinden emin olun
KartÄ±n takÄ±lÄ± olduÄŸunu kontrol edin
DoÄŸru kart kÃ¼tÃ¼phanesinin seÃ§ildiÄŸinden emin olun

Ä°mzalama Zaman AÅŸÄ±mÄ±
Hata: "Ä°ÅŸlem zaman aÅŸÄ±mÄ±na uÄŸradÄ±"
Ã‡Ã¶zÃ¼m:

E-imza uygulamasÄ±nda PIN girme ekranÄ± aÃ§Ä±k mÄ± kontrol edin
Browser console'da son durumu kontrol edin


ğŸ“‹ Console LoglarÄ±
BaÅŸarÄ±lÄ± bir imzalama iÅŸleminde ÅŸu loglarÄ± gÃ¶receksiniz:
âœ… [WS Service] BaÄŸlantÄ± baÅŸarÄ±lÄ±
âœ… [CardLogin] Terminal listesi alÄ±ndÄ±
âœ… [CardLogin] Login baÅŸarÄ±lÄ±
âœ… [CardLogin] Sertifikalar alÄ±ndÄ±: 2
âœ… [CardLogin] Sertifika baÅŸarÄ±yla seÃ§ildi
âœ… [PdfSign] PDF baÅŸarÄ±yla imzalandÄ±
âœ… [PdfSign] Ä°mzalÄ± PDF sunucuya yÃ¼klendi

ğŸ‰ BaÅŸarÄ± Kriterleri

 JNLP uygulamasÄ± Ã§alÄ±ÅŸÄ±yor (Port 5000)
 WebSocket baÄŸlantÄ±sÄ± kuruldu
 Terminal listesi geliyor
 Login iÅŸlemi Ã§alÄ±ÅŸÄ±yor
 Sertifika listesi geliyor
 Sertifika seÃ§imi Ã§alÄ±ÅŸÄ±yor
 PDF imzalanÄ±yor
 Ä°mzalÄ± PDF sunucuya yÃ¼kleniyor
 Modal dÃ¼zgÃ¼n kapanÄ±yor


ğŸ’¡ Ã–nemli Notlar

HTML dosyalarÄ± deÄŸiÅŸmedi - Sadece TypeScript dosyalarÄ±nÄ± gÃ¼ncelleyin
Eski servis kullanÄ±lmÄ±yor - IESignatureService artÄ±k kullanÄ±lmÄ±yor
CertList component gereksiz - Sertifikalar CardLogin iÃ§inde gÃ¶steriliyor
TÃ¼m loglar console'da - Hata ayÄ±klama iÃ§in F12 kullanÄ±n
WebSocket otomatik baÄŸlanÄ±r - Servis baÅŸlatÄ±ldÄ±ÄŸÄ±nda otomatik baÄŸlantÄ± kurar


ğŸ”„ Eski Sistemden Farklar
Ã–zellikEski SistemYeni SistemÄ°letiÅŸimHTTP APIWebSocketHÄ±zDaha yavaÅŸÃ‡ok hÄ±zlÄ±GerÃ§ek zamanlÄ±HayÄ±rEvetBaÄŸÄ±mlÄ±lÄ±kBackend servisiSadece JNLPSertifika listesiAyrÄ± componentCardLogin iÃ§indeConsole loglarÄ±AzDetaylÄ±

â“ YardÄ±m
Herhangi bir sorun yaÅŸarsanÄ±z:

Browser console'u kontrol edin (F12)
WebSocket baÄŸlantÄ± durumunu kontrol edin
JNLP uygulamasÄ±nÄ±n log dosyasÄ±nÄ± kontrol edin
Network sekmesinde WebSocket mesajlarÄ±nÄ± inceleyin